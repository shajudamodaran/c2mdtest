{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _once = require('lodash/once');\n\nvar _once2 = _interopRequireDefault(_once);\n\nvar _fp = require('lodash/fp');\n\nvar _uuid = require('uuid');\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar OTPublisher = function (_Component) {\n  _inherits(OTPublisher, _Component);\n\n  function OTPublisher(props, context) {\n    _classCallCheck(this, OTPublisher);\n\n    var _this = _possibleConstructorReturn(this, (OTPublisher.__proto__ || Object.getPrototypeOf(OTPublisher)).call(this, props));\n\n    _this.sessionConnectedHandler = function () {\n      _this.publishToSession(_this.state.publisher);\n    };\n\n    _this.streamCreatedHandler = function (event) {\n      _this.setState({\n        lastStreamId: event.stream.id\n      });\n    };\n\n    _this.state = {\n      publisher: null,\n      lastStreamId: '',\n      session: props.session || context.session || null\n    };\n    return _this;\n  }\n\n  _createClass(OTPublisher, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.createPublisher();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      var useDefault = function useDefault(value, defaultValue) {\n        return value === undefined ? defaultValue : value;\n      };\n\n      var shouldUpdate = function shouldUpdate(key, defaultValue) {\n        var previous = useDefault(prevProps.properties[key], defaultValue);\n        var current = useDefault(_this2.props.properties[key], defaultValue);\n        return previous !== current;\n      };\n\n      var updatePublisherProperty = function updatePublisherProperty(key, defaultValue) {\n        if (shouldUpdate(key, defaultValue)) {\n          var value = useDefault(_this2.props.properties[key], defaultValue);\n\n          _this2.state.publisher[key](value);\n        }\n      };\n\n      if (shouldUpdate('videoSource', undefined)) {\n        this.destroyPublisher();\n        this.createPublisher();\n        return;\n      }\n\n      updatePublisherProperty('publishAudio', true);\n      updatePublisherProperty('publishVideo', true);\n\n      if (this.state.session !== prevState.session) {\n        this.destroyPublisher(prevState.session);\n        this.createPublisher();\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (this.state.session) {\n        this.state.session.off('sessionConnected', this.sessionConnectedHandler);\n      }\n\n      this.destroyPublisher();\n    }\n  }, {\n    key: 'getPublisher',\n    value: function getPublisher() {\n      return this.state.publisher;\n    }\n  }, {\n    key: 'destroyPublisher',\n    value: function destroyPublisher() {\n      var _this3 = this;\n\n      var session = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.state.session;\n      delete this.publisherId;\n\n      if (this.state.publisher) {\n        this.state.publisher.off('streamCreated', this.streamCreatedHandler);\n\n        if (this.props.eventHandlers && _typeof(this.props.eventHandlers) === 'object') {\n          this.state.publisher.once('destroyed', function () {\n            _this3.state.publisher.off(_this3.props.eventHandlers);\n          });\n        }\n\n        if (session) {\n          session.unpublish(this.state.publisher);\n        }\n\n        this.state.publisher.destroy();\n      }\n    }\n  }, {\n    key: 'publishToSession',\n    value: function publishToSession(publisher) {\n      var _this4 = this;\n\n      var publisherId = this.publisherId;\n      this.state.session.publish(publisher, function (err) {\n        if (publisherId !== _this4.publisherId) {\n          // Either this publisher has been recreated or the\n          // component unmounted so don't invoke any callbacks\n          return;\n        }\n\n        if (err) {\n          _this4.errorHandler(err);\n        } else if (typeof _this4.props.onPublish === 'function') {\n          _this4.props.onPublish();\n        }\n      });\n    }\n  }, {\n    key: 'createPublisher',\n    value: function createPublisher() {\n      var _this5 = this;\n\n      if (!this.state.session) {\n        this.setState({\n          publisher: null,\n          lastStreamId: ''\n        });\n        return;\n      }\n\n      var properties = this.props.properties || {};\n      var container = void 0;\n\n      if (properties.insertDefaultUI !== false) {\n        container = document.createElement('div');\n        container.setAttribute('class', 'OTPublisherContainer');\n        this.node.appendChild(container);\n      }\n\n      this.publisherId = (0, _uuid2.default)();\n      var publisherId = this.publisherId;\n      this.errorHandler = (0, _once2.default)(function (err) {\n        if (publisherId !== _this5.publisherId) {\n          // Either this publisher has been recreated or the\n          // component unmounted so don't invoke any callbacks\n          return;\n        }\n\n        if (typeof _this5.props.onError === 'function') {\n          _this5.props.onError(err);\n        }\n      });\n      var publisher = OT.initPublisher(container, properties, function (err) {\n        if (publisherId !== _this5.publisherId) {\n          // Either this publisher has been recreated or the\n          // component unmounted so don't invoke any callbacks\n          return;\n        }\n\n        if (err) {\n          _this5.errorHandler(err);\n        } else if (typeof _this5.props.onInit === 'function') {\n          _this5.props.onInit();\n        }\n      });\n      publisher.on('streamCreated', this.streamCreatedHandler);\n\n      if (this.props.eventHandlers && _typeof(this.props.eventHandlers) === 'object') {\n        var handles = (0, _fp.omitBy)(_fp.isNil)(this.props.eventHandlers);\n        publisher.on(handles);\n      }\n\n      if (this.state.session.connection) {\n        this.publishToSession(publisher);\n      } else {\n        this.state.session.once('sessionConnected', this.sessionConnectedHandler);\n      }\n\n      this.setState({\n        publisher: publisher,\n        lastStreamId: ''\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this6 = this;\n\n      var _props = this.props,\n          className = _props.className,\n          style = _props.style;\n      return _react2.default.createElement('div', {\n        className: className,\n        style: style,\n        ref: function ref(node) {\n          _this6.node = node;\n        }\n      });\n    }\n  }]);\n\n  return OTPublisher;\n}(_react.Component);\n\nexports.default = OTPublisher;\nOTPublisher.propTypes = {\n  session: _propTypes2.default.shape({\n    connection: _propTypes2.default.shape({\n      connectionId: _propTypes2.default.string\n    }),\n    once: _propTypes2.default.func,\n    off: _propTypes2.default.func,\n    publish: _propTypes2.default.func,\n    unpublish: _propTypes2.default.func\n  }),\n  className: _propTypes2.default.string,\n  style: _propTypes2.default.object,\n  // eslint-disable-line react/forbid-prop-types\n  properties: _propTypes2.default.object,\n  // eslint-disable-line react/forbid-prop-types\n  eventHandlers: _propTypes2.default.objectOf(_propTypes2.default.func),\n  onInit: _propTypes2.default.func,\n  onPublish: _propTypes2.default.func,\n  onError: _propTypes2.default.func\n};\nOTPublisher.defaultProps = {\n  session: null,\n  className: '',\n  style: {},\n  properties: {},\n  eventHandlers: null,\n  onInit: null,\n  onPublish: null,\n  onError: null\n};\nOTPublisher.contextTypes = {\n  session: _propTypes2.default.shape({\n    connection: _propTypes2.default.shape({\n      connectionId: _propTypes2.default.string\n    }),\n    once: _propTypes2.default.func,\n    off: _propTypes2.default.func,\n    publish: _propTypes2.default.func,\n    unpublish: _propTypes2.default.func\n  })\n};","map":{"version":3,"sources":["/home/developer/Projects/Personal/Doctor-dashboard/Doctor Dash/connect2mydoctor-phase1/connect2mydoctor-phase1/node_modules/opentok-react/dist/OTPublisher.js"],"names":["Object","defineProperty","exports","value","_typeof","Symbol","iterator","obj","constructor","prototype","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","_react","require","_react2","_interopRequireDefault","_propTypes","_propTypes2","_once","_once2","_fp","_uuid","_uuid2","__esModule","default","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","OTPublisher","_Component","context","_this","getPrototypeOf","sessionConnectedHandler","publishToSession","state","publisher","streamCreatedHandler","event","setState","lastStreamId","stream","id","session","componentDidMount","createPublisher","componentDidUpdate","prevProps","prevState","_this2","useDefault","defaultValue","undefined","shouldUpdate","previous","properties","current","updatePublisherProperty","destroyPublisher","componentWillUnmount","off","getPublisher","_this3","arguments","publisherId","eventHandlers","once","unpublish","destroy","_this4","publish","err","errorHandler","onPublish","_this5","container","insertDefaultUI","document","createElement","setAttribute","node","appendChild","onError","OT","initPublisher","onInit","on","handles","omitBy","isNil","connection","render","_this6","_props","className","style","ref","Component","propTypes","shape","connectionId","string","func","object","objectOf","defaultProps","contextTypes"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _once = require('lodash/once');\n\nvar _once2 = _interopRequireDefault(_once);\n\nvar _fp = require('lodash/fp');\n\nvar _uuid = require('uuid');\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar OTPublisher = function (_Component) {\n  _inherits(OTPublisher, _Component);\n\n  function OTPublisher(props, context) {\n    _classCallCheck(this, OTPublisher);\n\n    var _this = _possibleConstructorReturn(this, (OTPublisher.__proto__ || Object.getPrototypeOf(OTPublisher)).call(this, props));\n\n    _this.sessionConnectedHandler = function () {\n      _this.publishToSession(_this.state.publisher);\n    };\n\n    _this.streamCreatedHandler = function (event) {\n      _this.setState({ lastStreamId: event.stream.id });\n    };\n\n    _this.state = {\n      publisher: null,\n      lastStreamId: '',\n      session: props.session || context.session || null\n    };\n    return _this;\n  }\n\n  _createClass(OTPublisher, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.createPublisher();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      var useDefault = function useDefault(value, defaultValue) {\n        return value === undefined ? defaultValue : value;\n      };\n\n      var shouldUpdate = function shouldUpdate(key, defaultValue) {\n        var previous = useDefault(prevProps.properties[key], defaultValue);\n        var current = useDefault(_this2.props.properties[key], defaultValue);\n        return previous !== current;\n      };\n\n      var updatePublisherProperty = function updatePublisherProperty(key, defaultValue) {\n        if (shouldUpdate(key, defaultValue)) {\n          var value = useDefault(_this2.props.properties[key], defaultValue);\n          _this2.state.publisher[key](value);\n        }\n      };\n\n      if (shouldUpdate('videoSource', undefined)) {\n        this.destroyPublisher();\n        this.createPublisher();\n        return;\n      }\n\n      updatePublisherProperty('publishAudio', true);\n      updatePublisherProperty('publishVideo', true);\n\n      if (this.state.session !== prevState.session) {\n        this.destroyPublisher(prevState.session);\n        this.createPublisher();\n      }\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (this.state.session) {\n        this.state.session.off('sessionConnected', this.sessionConnectedHandler);\n      }\n\n      this.destroyPublisher();\n    }\n  }, {\n    key: 'getPublisher',\n    value: function getPublisher() {\n      return this.state.publisher;\n    }\n  }, {\n    key: 'destroyPublisher',\n    value: function destroyPublisher() {\n      var _this3 = this;\n\n      var session = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.state.session;\n\n      delete this.publisherId;\n\n      if (this.state.publisher) {\n        this.state.publisher.off('streamCreated', this.streamCreatedHandler);\n\n        if (this.props.eventHandlers && _typeof(this.props.eventHandlers) === 'object') {\n          this.state.publisher.once('destroyed', function () {\n            _this3.state.publisher.off(_this3.props.eventHandlers);\n          });\n        }\n\n        if (session) {\n          session.unpublish(this.state.publisher);\n        }\n        this.state.publisher.destroy();\n      }\n    }\n  }, {\n    key: 'publishToSession',\n    value: function publishToSession(publisher) {\n      var _this4 = this;\n\n      var publisherId = this.publisherId;\n\n\n      this.state.session.publish(publisher, function (err) {\n        if (publisherId !== _this4.publisherId) {\n          // Either this publisher has been recreated or the\n          // component unmounted so don't invoke any callbacks\n          return;\n        }\n        if (err) {\n          _this4.errorHandler(err);\n        } else if (typeof _this4.props.onPublish === 'function') {\n          _this4.props.onPublish();\n        }\n      });\n    }\n  }, {\n    key: 'createPublisher',\n    value: function createPublisher() {\n      var _this5 = this;\n\n      if (!this.state.session) {\n        this.setState({ publisher: null, lastStreamId: '' });\n        return;\n      }\n\n      var properties = this.props.properties || {};\n      var container = void 0;\n\n      if (properties.insertDefaultUI !== false) {\n        container = document.createElement('div');\n        container.setAttribute('class', 'OTPublisherContainer');\n        this.node.appendChild(container);\n      }\n\n      this.publisherId = (0, _uuid2.default)();\n      var publisherId = this.publisherId;\n\n\n      this.errorHandler = (0, _once2.default)(function (err) {\n        if (publisherId !== _this5.publisherId) {\n          // Either this publisher has been recreated or the\n          // component unmounted so don't invoke any callbacks\n          return;\n        }\n        if (typeof _this5.props.onError === 'function') {\n          _this5.props.onError(err);\n        }\n      });\n\n      var publisher = OT.initPublisher(container, properties, function (err) {\n        if (publisherId !== _this5.publisherId) {\n          // Either this publisher has been recreated or the\n          // component unmounted so don't invoke any callbacks\n          return;\n        }\n        if (err) {\n          _this5.errorHandler(err);\n        } else if (typeof _this5.props.onInit === 'function') {\n          _this5.props.onInit();\n        }\n      });\n      publisher.on('streamCreated', this.streamCreatedHandler);\n\n      if (this.props.eventHandlers && _typeof(this.props.eventHandlers) === 'object') {\n        var handles = (0, _fp.omitBy)(_fp.isNil)(this.props.eventHandlers);\n        publisher.on(handles);\n      }\n\n      if (this.state.session.connection) {\n        this.publishToSession(publisher);\n      } else {\n        this.state.session.once('sessionConnected', this.sessionConnectedHandler);\n      }\n\n      this.setState({ publisher: publisher, lastStreamId: '' });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this6 = this;\n\n      var _props = this.props,\n          className = _props.className,\n          style = _props.style;\n\n      return _react2.default.createElement('div', { className: className, style: style, ref: function ref(node) {\n          _this6.node = node;\n        } });\n    }\n  }]);\n\n  return OTPublisher;\n}(_react.Component);\n\nexports.default = OTPublisher;\n\n\nOTPublisher.propTypes = {\n  session: _propTypes2.default.shape({\n    connection: _propTypes2.default.shape({\n      connectionId: _propTypes2.default.string\n    }),\n    once: _propTypes2.default.func,\n    off: _propTypes2.default.func,\n    publish: _propTypes2.default.func,\n    unpublish: _propTypes2.default.func\n  }),\n  className: _propTypes2.default.string,\n  style: _propTypes2.default.object, // eslint-disable-line react/forbid-prop-types\n  properties: _propTypes2.default.object, // eslint-disable-line react/forbid-prop-types\n  eventHandlers: _propTypes2.default.objectOf(_propTypes2.default.func),\n  onInit: _propTypes2.default.func,\n  onPublish: _propTypes2.default.func,\n  onError: _propTypes2.default.func\n};\n\nOTPublisher.defaultProps = {\n  session: null,\n  className: '',\n  style: {},\n  properties: {},\n  eventHandlers: null,\n  onInit: null,\n  onPublish: null,\n  onError: null\n};\n\nOTPublisher.contextTypes = {\n  session: _propTypes2.default.shape({\n    connection: _propTypes2.default.shape({\n      connectionId: _propTypes2.default.string\n    }),\n    once: _propTypes2.default.func,\n    off: _propTypes2.default.func,\n    publish: _propTypes2.default.func,\n    unpublish: _propTypes2.default.func\n  })\n};"]},"metadata":{},"sourceType":"script"}